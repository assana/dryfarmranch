<!DOCTYPE html>
<html>
<head>
<%- include ('../partials/header.ejs', {pageTitle:'Contact Us'}); %>
<script type="text/javascript" src="/libs/validator.min.js"></script>

<%- include ('../styles.ejs'); %>
<style type="text/css">
.grecaptcha-badge  { visibility: visible; }
.vert {border-right: 1px solid var(--medium-grey9);}
</style>

</head>

<body>
<%- include ('../partials/navbar.ejs', {removeReqButton: true}) %>
<%- include ('../partials/logo.ejs', {expired: 0}); %>
<%- include ('../partials/containerTop.ejs'); %>

<section id="nextSteps">
<div class="sectionTitle d-flex justify-content-center justify-content-md-start">
    <span class="HRSS_ss05">Contact Us</span></div>
<hr />

<p>
    Experience the beauty and potential of Dry Farm Ranch firsthand.
    Schedule a Site Visit.</span>
</p>
</section>

<div class="vision m-0 p-0 m-2">
<div class="row justify-content-between m-0 p-0">

<div class="col-12 col-md-3 d-flex pt-3">
<p><span class="fw-bold">email</span><br />
    <a href="mailto:info@dryfarmranch.com
        ?subject=Enquiry%20about%20DFR" target="_top">
        info@DryFarmRanch.com</a>
</p>
</div>	<!-- email column -->

<div class="col-0 col-md-1 vert"></div>

<div class="col-12 col-md-8"> <!-- Form column -->
<form id="contactForm" class="mt-4" action="/contact" method="POST">
<div class="row m-0 p-0 mt-2">
    <label class="d-none d-md-block col-12 col-md-3 m-0 mt-2 px-0 px-md-2 col-form-label text-start text-md-end" for="first">*Name</label>
        <div class="col-12 col-md-9 m-0 p-0 mt-2">
            <input class="form-control" type="text"
                name="customerName" required autofocus placeholder="Name" >
        </div>
    <label class="d-none d-md-block col-12 col-md-3 m-0 mt-2 px-0 px-md-2 col-form-label text-start text-md-end" for="email">*E-mail</label>
        <div class="col-12 col-md-9 m-0 p-0 mt-2">
            <input class="form-control" type="email"
                name="email" required placeholder="email">
        </div>
    <label class="d-none d-md-block col-12 col-md-3 m-0 mt-2 px-0 px-md-2 col-form-label text-start text-md-end" for="phone">*Phone #</label>
        <div class="col-12 col-md-9 m-0 p-0 mt-2">
            <input class="form-control m-0" type="tel" minlength=10 name="phone" required
                placeholder="(###) ###-####">
        </div>
    <label class="d-none d-md-block col-12 col-md-3 m-0 mt-2 px-0 px-md-2 col-form-label text-start text-md-end" for="details">*Comments</label>
        <div class="col-12 col-md-9 m-0 p-0 mt-2">
        <textarea class="form-control" name="details" required
            placeholder="Ask us..." rows="4"></textarea>
	</div>
</div>
</form>

<div class="d-flex justify-content-end align-items-end py-4">
        <%- include ('../partials/goBackButton.ejs'); %>
        <button form="contactForm" type="reset" 
	    class="btn btn-outline-secondary mx-2">Clear</button>
        <button form="contactForm" type="submit" 
	    class="btn btn-outline-success me-2">Send</button>
</div>
</div> <!-- form column -->

</div> <!-- white box row -->
</div> <!-- Form card -->

<%- include ('../partials/containerBottom.ejs'); %>
<%- include ('../partials/footer.ejs'); %>
<%- include ('../partials/singlePageHeight.ejs'); %>
<%- include ('../partials/navbarShrink.ejs'); %>
</body>

<script type="text/javascript">
const validateFormData = async(data) => 
{
console.log(data);
    let valid = true;
    let message = '';
    if (!data.first || !data.last) {
	valid = false;
	message = `${message}\nPlease provide your first and last name`;
    }
    if (!validator.isEmail(data.email)) {
	valid = false;
	message = `${message}\nPlease enter a valid email address`;
    }
    if (!validator.isMobilePhone(data.phone, ['en-US'])) {
	valid = false;
	message = `${message}\nPlease enter a valid phone number`;
    }
    if (!data.details) {
	valid = false;
	message = `${message}\nPlease provide some details`;
    }
    return {valid, message};
}

$(document).ready(function() {

    document.querySelector("#contactForm").addEventListener ("submit", async (e) => {
    try {
	e.preventDefault();
	const form = document.querySelector('#contactForm');
	const formData = Object.fromEntries(new FormData(form));

	const key = await fetch ('/reCaptchaKey', {
	    method: "POST",
	    body: JSON.stringify({}),
	    headers: { "Content-Type": "application/json"},
	    json: true
	});
	const siteKey = (await key.json()).siteKey;
	grecaptcha.ready(async () => {
	    grecaptcha.execute(`${siteKey}`, {action: 'submit'}).then(async (token) => {
		try {
		    const json = JSON.stringify({...formData, token});
		    const response = await fetch (form.action, {
			method: "POST",
			body : json,
			headers: { "Content-Type": "application/json" }
		    });
		    const data = await response.json();
		    window.location.assign (data.redirect);
		} catch (e) {
		    window.location.assign ('/');
		    return (e);
		}
	    }).catch((error) => {
		console.log('Error!', error);
		window.location.assign ('/');
	    });
	});
    } catch (e) {
	console.log(e);
    }
    });
});

</script>
</html>
